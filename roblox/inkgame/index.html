
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reaction Circle Trainer</title>
<style>
  body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #111; color: #fff; font-family: sans-serif; margin:0; }
  #game, #startScreen, #endScreen { position: relative; width: 600px; height: 400px; border-radius: 10px; display: flex; justify-content: center; align-items: center; flex-direction: column; }
  #game { background: #222; overflow: hidden; display: none; }
  #startScreen { background: #333; }
  #endScreen { background: #333; display: none; }
  .circle { position: absolute; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; pointer-events: none; }
  .active { background: white; color: black; }
  .frozen { background: rgba(255,0,0,0.4); color: grey; }
  .feedback { position: absolute; font-size: 20px; font-weight: bold; pointer-events: none; transition: all 0.7s ease-out; }
  #score { position: absolute; top: 10px; left: 10px; font-size: 20px; }
  button { padding: 10px 20px; font-size: 18px; cursor: pointer; border-radius: 5px; border: none; background: #0f0; color: #111; font-weight: bold; }
</style>
</head>
<body>

<div id="startScreen">
  <h1>Reaction Circle Trainer</h1>
  <button id="startButton">Start Game</button>
</div>

<div id="game">
  <div id="score">Score: 0</div>
</div>

<div id="endScreen">
  <h1 id="resultText"></h1>
  <button id="retryButton">Retry</button>
</div>

<script>
const game = document.getElementById('game');
const scoreEl = document.getElementById('score');
const keys = ['Q','E','R','F'];
let score = 0;
let activeCircle = null;
let frozenCircle = null;
let shrinkTimer = null;
const perfectSize = 35;
const shrinkDuration = 700; // 0.7s shrink time

const startScreen = document.getElementById('startScreen');
const startButton = document.getElementById('startButton');
const endScreen = document.getElementById('endScreen');
const resultText = document.getElementById('resultText');
const retryButton = document.getElementById('retryButton');

function spawnCircle(isFrozen=false) {
  const key = keys[Math.floor(Math.random() * keys.length)];
  const maxX = game.clientWidth - 150;
  const maxY = game.clientHeight - 150;
  const posX = Math.random() * maxX;
  const posY = Math.random() * maxY;

  const circle = document.createElement('div');
  circle.classList.add('circle');
  circle.style.left = posX + 'px';
  circle.style.top = posY + 'px';
  circle.style.width = '150px';
  circle.style.height = '150px';
  circle.textContent = key;

  if (isFrozen) {
    circle.classList.add('frozen');
    frozenCircle = { el: circle, key, posX, posY, size: 150 };
  } else {
    circle.classList.add('active');
    activeCircle = { el: circle, key, posX, posY, size: 150 };
  }

  game.appendChild(circle);
}

function startShrinking() {
  let startTime = performance.now();

  function animate(time) {
    if (!activeCircle) return;
    let elapsed = time - startTime;
    let progress = elapsed / shrinkDuration;

    if (progress >= 1) {
      // Miss
      updateScore(-1);
      showFeedback('Miss', activeCircle.posX+75, activeCircle.posY, 'red');
      removeCircle(activeCircle);
      activateFrozen();
      return;
    }

    let newSize = 150 - progress * (150 - 30);
    activeCircle.size = newSize;
    activeCircle.el.style.width = newSize + 'px';
    activeCircle.el.style.height = newSize + 'px';
    activeCircle.el.style.left = activeCircle.posX + (150 - newSize)/2 + 'px';
    activeCircle.el.style.top = activeCircle.posY + (150 - newSize)/2 + 'px';

    shrinkTimer = requestAnimationFrame(animate);
  }

  shrinkTimer = requestAnimationFrame(animate);
}

function activateFrozen() {
  if (frozenCircle) {
    // make frozen into active
    frozenCircle.el.classList.remove('frozen');
    frozenCircle.el.classList.add('active');
    activeCircle = { ...frozenCircle };
    frozenCircle = null;
    startShrinking();
    // spawn a new frozen circle queued up
    spawnCircle(true);
  } else {
    spawnCircle();
    startShrinking();
  }
}

function removeCircle(circleObj) {
  if (!circleObj) return;
  circleObj.el.remove();
  if (circleObj === activeCircle) activeCircle = null;
  if (circleObj === frozenCircle) frozenCircle = null;
}

function showFeedback(text, x, y, color='white') {
  const feedback = document.createElement('div');
  feedback.classList.add('feedback');
  feedback.textContent = text;
  feedback.style.left = x + 'px';
  feedback.style.top = y + 'px';
  feedback.style.color = color;
  game.appendChild(feedback);
  setTimeout(() => {
    feedback.style.top = (y - 30) + 'px';
    feedback.style.opacity = 0;
  }, 50);
  setTimeout(() => feedback.remove(), 750);
}

function updateScore(points) {
  score += points;
  if (score < 0) score = 0;
  scoreEl.textContent = 'Score: ' + score;
  if (score >= 20) endGame();
}

document.addEventListener('keydown', (e) => {
  if (!activeCircle) return;
  if (e.key.toUpperCase() === activeCircle.key) {
    let size = activeCircle.size;
    let points = 0;
    let feedbackText = 'Miss';
    let color = 'red';

    if (size >= perfectSize-10 && size <= perfectSize+10) {
      points = 2; feedbackText = 'Perfect'; color = 'lime';
    } else if (size >= perfectSize-20 && size <= perfectSize+20) {
      points = 1; feedbackText = 'Good'; color = 'yellow';
    } else {
      points = -1; feedbackText = 'Miss'; color = 'red';
    }

    updateScore(points);
    showFeedback(feedbackText, activeCircle.posX+size/2, activeCircle.posY, color);
    cancelAnimationFrame(shrinkTimer);
    removeCircle(activeCircle);
    activateFrozen();
  }
});

function endGame() {
  if (activeCircle) removeCircle(activeCircle);
  if (frozenCircle) removeCircle(frozenCircle);
  game.style.display = 'none';
  endScreen.style.display = 'flex';
  resultText.textContent = score >= 20 ? 'You Win!' : 'You Lose!';
}

startButton.addEventListener('click', () => {
  startScreen.style.display = 'none';
  endScreen.style.display = 'none';
  game.style.display = 'flex';
  score = 0;
  scoreEl.textContent = 'Score: 0';
  spawnCircle();      // active
  spawnCircle(true);  // frozen
  startShrinking();
});

retryButton.addEventListener('click', () => {
  startScreen.style.display = 'none';
  endScreen.style.display = 'none';
  game.style.display = 'flex';
  score = 0;
  scoreEl.textContent = 'Score: 0';
  spawnCircle();      // active
  spawnCircle(true);  // frozen
  startShrinking();
});
</script>
</body>
</html>
