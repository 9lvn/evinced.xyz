<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Farm Calculator</title>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
.card {
  background: #020617;
  padding: 24px;
  border-radius: 16px;
  width: 540px;
}
.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.tab {
  flex: 1;
  padding: 8px;
  border-radius: 8px;
  background: #1e293b;
  text-align: center;
  cursor: pointer;
}
.tab.active {
  background: #2563eb;
}
label {
  display: block;
  margin-top: 10px;
  font-size: 0.9rem;
}
input {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: none;
  margin-top: 4px;
}
button {
  width: 100%;
  margin-top: 16px;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #2563eb;
  color: white;
  cursor: pointer;
}
.results {
  margin-top: 16px;
  background: #020617;
  padding: 12px;
  border-radius: 10px;
}
.hidden {
  display: none;
}
</style>
</head>

<body>
<div class="card">

  <div class="tabs">
    <div class="tab active" id="tabNormal">Normal</div>
    <div class="tab" id="tabGoal">Goal</div>
  </div>

  <!-- Normal calculation -->
  <div id="normalTab">
    <label>Available bones</label>
    <input id="bones" placeholder="e.g. 3m or 1dc">

    <label>Available blaze rods</label>
    <input id="rods" placeholder="e.g. 1m">

    <label>Bone price</label>
    <input id="bonePrice" placeholder="136">

    <label>Rod price</label>
    <input id="rodPrice" placeholder="150">

    <button onclick="calculateNormal()">Calculate</button>
  </div>

  <!-- Goal calculation -->
  <div id="goalTab" class="hidden">
    <label>Desired runtime (hours)</label>
    <input id="goalHours" placeholder="e.g. 6">

    <label>OR desired total profit</label>
    <input id="goalProfit" placeholder="e.g. 500m">

    <label>Bone price</label>
    <input id="goalBonePrice" placeholder="136">

    <label>Rod price</label>
    <input id="goalRodPrice" placeholder="150">

    <button onclick="calculateGoal()">Calculate</button>
  </div>

  <div class="results" id="results">Enter values to calculate.</div>
</div>

<script>
const BONES_PER_HOUR = 255000;
const RODS_PER_HOUR = 75000;
const BONES_PER_KELP_BLOCK = 3;
const KELP_BLOCK_PRICE = 750;
const ITEMS_PER_DC = 93312;

function parseValue(value) {
  if (!value) return 0;
  const v = value.toLowerCase().trim();
  let n = parseFloat(v);
  if (v.endsWith("dc")) return n * ITEMS_PER_DC;
  if (v.endsWith("k")) return n * 1e3;
  if (v.endsWith("m")) return n * 1e6;
  if (v.endsWith("b")) return n * 1e9;
  return n;
}

function formatAbbr(n) {
  const a = Math.abs(n);
  if (a >= 1e9) return (n / 1e9).toFixed(2) + "b";
  if (a >= 1e6) return (n / 1e6).toFixed(2) + "m";
  if (a >= 1e3) return (n / 1e3).toFixed(2) + "k";
  return Math.round(n).toString();
}

function formatTime(hours) {
  const totalSeconds = Math.floor(hours * 3600);
  const h = Math.floor(totalSeconds / 3600);
  const m = Math.floor((totalSeconds % 3600) / 60);
  const s = totalSeconds % 60;
  return `${h}h ${m}m ${s}s`;
}

function calculateNormal() {
  const bones = parseValue(document.getElementById("bones").value);
  const rods = parseValue(document.getElementById("rods").value);
  const bonePrice = parseValue(document.getElementById("bonePrice").value || 136);
  const rodPrice = parseValue(document.getElementById("rodPrice").value || 150);

  if (bones <= 0 || rods <= 0) {
    results.innerHTML = "Both bones and blaze rods are required.";
    return;
  }

  const runtimeHours = Math.min(
    bones / BONES_PER_HOUR,
    rods / RODS_PER_HOUR
  );

  const costPerHour =
    BONES_PER_HOUR * bonePrice +
    RODS_PER_HOUR * rodPrice;

  const revenuePerHour =
    (BONES_PER_HOUR / BONES_PER_KELP_BLOCK) *
    KELP_BLOCK_PRICE;

  const totalProfit =
    (revenuePerHour - costPerHour) * runtimeHours;

  results.innerHTML = `
    <strong>Runtime</strong><br>${formatTime(runtimeHours)}<br><br>
    <strong>Cost / hour</strong><br>${formatAbbr(costPerHour)}<br>
    <strong>Revenue / hour</strong><br>${formatAbbr(revenuePerHour)}<br><br>
    <strong>Total profit</strong><br>${formatAbbr(totalProfit)}
  `;
}

function calculateGoal() {
  const hours = parseValue(document.getElementById("goalHours").value);
  const targetProfit = parseValue(document.getElementById("goalProfit").value);
  const bonePrice = parseValue(document.getElementById("goalBonePrice").value || 136);
  const rodPrice = parseValue(document.getElementById("goalRodPrice").value || 150);

  const costPerHour =
    BONES_PER_HOUR * bonePrice +
    RODS_PER_HOUR * rodPrice;

  const revenuePerHour =
    (BONES_PER_HOUR / BONES_PER_KELP_BLOCK) *
    KELP_BLOCK_PRICE;

  const profitPerHour = revenuePerHour - costPerHour;
  const runtimeHours = hours > 0 ? hours : targetProfit / profitPerHour;

  const bonesNeeded = BONES_PER_HOUR * runtimeHours;
  const rodsNeeded = RODS_PER_HOUR * runtimeHours;
  const totalProfit = profitPerHour * runtimeHours;

  results.innerHTML = `
    <strong>Runtime</strong><br>${formatTime(runtimeHours)}<br><br>
    <strong>Bones needed</strong><br>${formatAbbr(bonesNeeded)}<br>
    <strong>Blaze rods needed</strong><br>${formatAbbr(rodsNeeded)}<br><br>
    <strong>Total profit</strong><br>${formatAbbr(totalProfit)}
  `;
}

/* tab switching */
const tabNormal = document.getElementById("tabNormal");
const tabGoal = document.getElementById("tabGoal");
const normalTab = document.getElementById("normalTab");
const goalTab = document.getElementById("goalTab");

tabNormal.onclick = () => {
  tabNormal.classList.add("active");
  tabGoal.classList.remove("active");
  normalTab.classList.remove("hidden");
  goalTab.classList.add("hidden");
};

tabGoal.onclick = () => {
  tabGoal.classList.add("active");
  tabNormal.classList.remove("active");
  goalTab.classList.remove("hidden");
  normalTab.classList.add("hidden");
};
</script>
</body>
</html>
