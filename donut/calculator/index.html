<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Farm Calculator</title>

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
.card {
  background: #020617;
  padding: 24px;
  border-radius: 16px;
  width: 560px;
}
.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.tab {
  flex: 1;
  padding: 8px;
  border-radius: 8px;
  background: #1e293b;
  text-align: center;
  cursor: pointer;
}
.tab.active {
  background: #2563eb;
}
label {
  display: block;
  margin-top: 10px;
}
input {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  border: none;
  margin-top: 4px;
}
button {
  width: 100%;
  margin-top: 16px;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #2563eb;
  color: white;
  cursor: pointer;
}
.results {
  margin-top: 16px;
  background: #020617;
  padding: 14px;
  border-radius: 10px;
}
.hidden {
  display: none;
}
</style>
</head>

<body>
<div class="card">

<div class="tabs">
  <div class="tab active" id="tabNormal">Normal</div>
  <div class="tab" id="tabGoal">Goal</div>
  <div class="tab" id="tabInvest">Investment</div>
</div>

<!-- NORMAL -->
<div id="normalTab">
  <label>Available bones</label>
  <input id="bones">

  <label>Available blaze rods</label>
  <input id="rods">

  <label>Bone price</label>
  <input id="bonePrice" value="136">

  <label>Rod price</label>
  <input id="rodPrice" value="150">

  <button onclick="calculateNormal()">Calculate</button>
</div>

<!-- GOAL -->
<div id="goalTab" class="hidden">
  <label>Desired runtime (hours)</label>
  <input id="goalHours">

  <label>OR desired total profit</label>
  <input id="goalProfit">

  <label>Bone price</label>
  <input id="goalBonePrice" value="136">

  <label>Rod price</label>
  <input id="goalRodPrice" value="150">

  <button onclick="calculateGoal()">Calculate</button>
</div>

<!-- INVESTMENT -->
<div id="investTab" class="hidden">
  <label>Current bones</label>
  <input id="currentBones">

  <label>Current blaze rods</label>
  <input id="currentRods">

  <label>Investment budget</label>
  <input id="investment">

  <label>Bone price</label>
  <input id="invBonePrice" value="136">

  <label>Rod price</label>
  <input id="invRodPrice" value="150">

  <button onclick="calculateInvestment()">Calculate</button>
</div>

<div class="results" id="results">Enter values to calculate.</div>
</div>

<script>
const BONES_PER_HOUR = 255000
const RODS_PER_HOUR = 75000
const TARGET_RATIO = 3.75
const BONES_PER_KELP_BLOCK = 3
const KELP_BLOCK_PRICE = 750

function parseValue(v) {
  if (!v) return 0
  v = v.toLowerCase().trim()
  let n = parseFloat(v)
  if (v.endsWith("k")) return n * 1e3
  if (v.endsWith("m")) return n * 1e6
  if (v.endsWith("b")) return n * 1e9
  return n
}

function abbr(n) {
  if (n >= 1e9) return (n / 1e9).toFixed(2) + "b"
  if (n >= 1e6) return (n / 1e6).toFixed(2) + "m"
  if (n >= 1e3) return (n / 1e3).toFixed(2) + "k"
  return Math.round(n)
}

function time(h) {
  const s = Math.floor(h * 3600)
  return `${Math.floor(s / 3600)}h ${Math.floor((s % 3600) / 60)}m ${s % 60}s`
}

/* NORMAL */
function calculateNormal() {
  const b = parseValue(bones.value)
  const r = parseValue(rods.value)
  const bp = parseValue(bonePrice.value)
  const rp = parseValue(rodPrice.value)

  if (b <= 0 || r <= 0) {
    results.innerHTML = "Bones and blaze rods are required."
    return
  }

  const runtime = Math.min(b / BONES_PER_HOUR, r / RODS_PER_HOUR)
  const costPH = BONES_PER_HOUR * bp + RODS_PER_HOUR * rp
  const revenuePH = (BONES_PER_HOUR / BONES_PER_KELP_BLOCK) * KELP_BLOCK_PRICE

  const totalCost = costPH * runtime
  const totalRevenue = revenuePH * runtime
  const profit = totalRevenue - totalCost

  results.innerHTML = `
    <strong>Runtime</strong><br>${time(runtime)}<br><br>
    Cost / hour: ${abbr(costPH)}<br>
    Revenue / hour: ${abbr(revenuePH)}<br><br>
    Total cost: ${abbr(totalCost)}<br>
    Total revenue: ${abbr(totalRevenue)}<br>
    <strong>Total profit: ${abbr(profit)}</strong>
  `
}

/* GOAL */
function calculateGoal() {
  const hoursIn = parseValue(goalHours.value)
  const profitIn = parseValue(goalProfit.value)
  const bp = parseValue(goalBonePrice.value)
  const rp = parseValue(goalRodPrice.value)

  const revenuePH = (BONES_PER_HOUR / BONES_PER_KELP_BLOCK) * KELP_BLOCK_PRICE
  const costPH = BONES_PER_HOUR * bp + RODS_PER_HOUR * rp
  const profitPH = revenuePH - costPH

  const runtime = hoursIn > 0 ? hoursIn : profitIn / profitPH

  const bonesUsed = BONES_PER_HOUR * runtime
  const rodsUsed = RODS_PER_HOUR * runtime

  const totalCost = costPH * runtime
  const totalRevenue = revenuePH * runtime
  const profit = totalRevenue - totalCost

  results.innerHTML = `
    <strong>Runtime</strong><br>${time(runtime)}<br><br>
    Bones used: ${abbr(bonesUsed)}<br>
    Blaze rods used: ${abbr(rodsUsed)}<br><br>
    Total cost: ${abbr(totalCost)}<br>
    Total revenue: ${abbr(totalRevenue)}<br>
    <strong>Total profit: ${abbr(profit)}</strong>
  `
}

/* INVESTMENT */
function calculateInvestment() {
  const cb = parseValue(currentBones.value)
  const cr = parseValue(currentRods.value)
  const budget = parseValue(investment.value)
  const bp = parseValue(invBonePrice.value)
  const rp = parseValue(invRodPrice.value)

  if (budget <= 0) {
    results.innerHTML = "Investment budget is required."
    return
  }

  const costPerSet = TARGET_RATIO * bp + rp
  const totalRods = (budget + cb * bp + cr * rp) / costPerSet
  const totalBones = totalRods * TARGET_RATIO

  const buyBones = Math.max(0, totalBones - cb)
  const buyRods = Math.max(0, totalRods - cr)

  const runtime = Math.min(
    totalBones / BONES_PER_HOUR,
    totalRods / RODS_PER_HOUR
  )

  const revenuePH = (BONES_PER_HOUR / BONES_PER_KELP_BLOCK) * KELP_BLOCK_PRICE
  const costPH = BONES_PER_HOUR * bp + RODS_PER_HOUR * rp

  const totalCost = costPH * runtime
  const totalRevenue = revenuePH * runtime
  const profit = totalRevenue - totalCost

  results.innerHTML = `
    Bones to buy: ${abbr(buyBones)}<br>
    Blaze rods to buy: ${abbr(buyRods)}<br><br>
    Runtime: ${time(runtime)}<br><br>
    Total cost: ${abbr(totalCost)}<br>
    Total revenue: ${abbr(totalRevenue)}<br>
    <strong>Total profit: ${abbr(profit)}</strong>
  `
}

/* TABS */
function switchTab(active, show) {
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"))
  document.querySelectorAll("#normalTab,#goalTab,#investTab").forEach(t => t.classList.add("hidden"))
  active.classList.add("active")
  show.classList.remove("hidden")
}

tabNormal.onclick = () => switchTab(tabNormal, normalTab)
tabGoal.onclick = () => switchTab(tabGoal, goalTab)
tabInvest.onclick = () => switchTab(tabInvest, investTab)
</script>
</body>
</html>
